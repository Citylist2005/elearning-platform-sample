<!doctype html>
<html><head>
  <meta charset="utf-8">
  <title>Courses</title>
  <link rel="stylesheet" href="/styles.css">
</head><body>
  <h2>Available Courses</h2>
  <div id="userArea"></div>
  <div id="courses"></div>
  <a href="/">Home</a>
  <script>
    async function load(){
      const me = await (await fetch('/api/me')).json();
      const c = await (await fetch('/api/courses')).json();
      const coursesDiv = document.getElementById('courses');
      coursesDiv.innerHTML = '';
      c.forEach(course => {
        const el = document.createElement('div');
        el.className = 'course-card';
        el.innerHTML = `<h3>${course.title}</h3><p>Seats: ${course.seats}</p>
          <a href="/course.html?id=${encodeURIComponent(course.id)}">Open</a>`;
        coursesDiv.appendChild(el);
      });
      const userArea = document.getElementById('userArea');
      if (me.loggedIn){
        userArea.innerHTML = `Hello ${me.user.username} | <a href="#" id="logout">Logout</a> | <a href="/course.html">My Courses</a>`;
        document.getElementById('logout').addEventListener('click', async (e)=>{
          e.preventDefault();
          await fetch('/api/logout', { method:'POST' });
          location.reload();
        });
      } else {
        userArea.innerHTML = `<a href="/login.html">Login</a> | <a href="/register.html">Register</a>`;
      }
    }
    load();
  </script>
</body></html>
